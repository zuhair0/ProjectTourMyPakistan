@page "/tourguidereg"
@using ClassLibraryDAL
@using ClassLibraryModel
<h3 class="text-center">Tour Guide Registration</h3>
<EditForm Model="tourGuideRegistration" OnSubmit="SaveTourGuideReg">
    <label>Name: </label>
    <input type="text" @bind-value="tourGuideRegistration.TG_name" /><br />
    <label>CNIC# </label>
    <input type="number" @bind-value="tourGuideRegistration.TG_cnic" /><br />
    <label>D.O.B: </label>
    <input type="text" @bind-value="tourGuideRegistration.TG_DOB" /><br />
    <label>Gender: </label>
    <input type="text" @bind-value="tourGuideRegistration.TG_Gender" /><br />
    <label>Mobile: </label>
    <input type="number" @bind-value="tourGuideRegistration.TG_Mobile" /><br />
    <label>WhatsApp</label>
    <input type="number" @bind-value="tourGuideRegistration.TG_Whatsapp" /><br />
    <label>Landline: </label>
    <input type="number" @bind-value="tourGuideRegistration.TG_Landline" /><br />
    <label>City</label>
    <select @onchange="SelectedCity">
        @foreach (var item in CityList)
        {
            <option value="@item.City_name">@item.City_name</option>
        }
    </select> @city<br />
    <label>Sector</label>
    <input type="text" @bind-value="tourGuideRegistration.TG_Sector" /><br />
    <label>Longitude: </label>
    <input type="number" @bind-value="tourGuideRegistration.TG_Longitude" /><br />
    <label>Latitude: </label>
    <input type="number" @bind-value="tourGuideRegistration.TG_latitude" /><br />
    <label>Reg Date</label>
    <input type="datetime" @bind-value="tourGuideRegistration.TG_registration_date" min="1/1/2000 12:00:00 AM"/><br />
    <label>Reg Time</label>
    <input type="datetime" @bind-value="tourGuideRegistration.TG_registration_time" min="1/1/2000 12:00:00 AM"/><br />

    <button type="submit">save</button>
</EditForm>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Name</th>
            <th>Gender</th>
            <th>DOB</th>
            <th>Contact</th>
            <th>Action</th>
        </tr>
    </thead>
    @foreach (var item in tourGuideRegistrationsList)
    {
        <tr>
            <td>@item.TG_name</td>
            <td>@item.TG_Gender</td>
            <td>@item.TG_DOB</td>
            <td>@item.TG_Mobile</td>
            <button @onclick="(()=>DeleteTourGuide(item.TG_id))">
                Delete
            </button>
            <button>
                <a href="tourcompanyreg/@item.TG_id">Add company</a>
            </button>
        </tr>
    }
</table>
<p>@msg</p>
@code {
    private string? msg { get; set; }
    private TourGuideRegistrationModel tourGuideRegistration = new TourGuideRegistrationModel();
    private List<TourGuideRegistrationModel> tourGuideRegistrationsList = new List<TourGuideRegistrationModel>();
    private List<TourismModel> CityList = new List<TourismModel>();
    private string? city { get; set; }
    private void SaveTourGuideReg(){
        tourGuideRegistration.TG_city = city;
        int i = TourGuideRegistrationDAL.SaveTourGuideRegistration(tourGuideRegistration);
        if (i == 1)
        {
            msg = "Tour Guide Saved successfully";
            GetTourGuides();
        }
        else
        {
            msg = "Error while saving Tour Guide";
        }
    }
    protected override void OnInitialized()
    {
        GetTourGuides();
        LoadCities();
    }
    private void GetTourGuides(){
        tourGuideRegistrationsList = TourGuideRegistrationDAL.GetTourGuideRegistrations();
    }
    private void DeleteTourGuide(int id){
        int i = TourGuideRegistrationDAL.DeleteTourGuide(id);
        if (i == 1)
        {
            msg = "Tour Guide Deleted successfully";
            GetTourGuides();
        }
        else
        {
            msg = "Error while saving Tour Guide";
        }
    }
    private void LoadCities(){
        CityList = TourismDAL.GetCities();
    }
    private void SelectedCity(ChangeEventArgs e){
        city = e.Value.ToString();
    }
}
